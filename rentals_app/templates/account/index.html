{% extends "Base.html" %}
{% block title %}Account{% endblock %}
{% block content %}
<div class="container-fluid bg-dark">
    <div class="row">
        <div class="col-md-10 mx-auto">
            <h3 class="text-white py-3 fw-bold">My Account</h3>
        </div>
    </div>
</div>

<!--Account Nav-->
<div class="container-fluid bg-dark">

    <div class="row">
        <div class="col-md-10 mx-auto my-2">
            <ul class="nav nav-pills"
                id="account_tabs_root">
                <li class="nav-item">
                    <a class="nav-link text-white active d-flex flex-row"
                       aria-current="page"
                       id="tab_switcher_index"
                       href="{{url_for('account.index')}}">
                        <span class="material-icons-round me-3">
                            contact_phone
                        </span>My Information
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white d-flex flex-row"
                       id="tab_switcher_reservations"
                       href="{{url_for('account.reservations')}}">
                        <span class="material-icons-round me-3">
                            agriculture
                        </span>Reservations
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white d-flex flex-row"
                       id="tab_switcher_reservations"
                       href="{{url_for('account.render_messages')}}">
                        <span class="material-icons-round me-3">
                            question_answer
                        </span>Messages
                    </a>
                </li>
                {% if user.groups == "admin" %}
                <li class="nav-item ms-auto">
                    <a class="nav-link text-white d-flex flex-row"
                       href="{{url_for('admin.root')}}">
                        <span class="material-icons-round me-3">
                            admin_panel_settings
                        </span>
                        Manage Site
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</div>

<!--Content-->
<div class="container-fluid">
    <div class="row mx-3">
        <div class="col-md-10 mx-auto my-5">
            <div class="row">
                <div class="col col-md-6">
                    <div class="card p-3 bg-white d-flex flex-column">
                        <h4 class="fw-bold">Account Information</h4>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex flex-row align-content-center">
                                <span class="material-icons-round me-3">
                                    person
                                </span>
                                <span class="flex-grow-1">
                                    {{user.firstname}} {{user.lastname}}
                                </span>
                            </li>
                            <li class="list-group-item d-flex flex-row">
                                <span class="material-icons-round me-3">
                                    alternate_email
                                </span>
                                <span class="flex-grow-1">
                                    {{user.email}}
                                </span>
                            </li>
                            <li class="list-group-item d-flex flex-row">
                                <span class="material-icons-round me-3">
                                    phone
                                </span>
                                <span class="flex-grow-1">
                                    {{user.phonenumber}}
                                </span>
                            </li>
                            <li class="list-group-item d-flex flex-row">
                                <span class="material-icons-round me-3">
                                    person_pin_circle
                                </span>
                                <span class="flex-grow-1">
                                    <div class="d-flex flex-column">
                                        <span>{{user.address}}</span>
                                        <span>{{user.city}}, {{user.state}} {{user.zip}}
                                        </span>
                            </li>
                            <li class="list-group-item d-flex flex-row">
                                <span class="material-icons-round me-3">
                                    group_work
                                </span>
                                <span class="flex-grow-1">
                                    {{user.groups}}
                                </span>
                            </li>
                            <li class="list-group-item d-flex flex-row">
                                <span class="material-icons-round me-3">
                                    vpn_key
                                </span>
                                <span class="flex-grow-1">
                                    <button type="button"
                                            class="btn btn-outline-dark"
                                            data-bs-toggle="modal"
                                            data-bs-target="#ch_pwd_modal">
                                        Change Password
                                    </button>
                                </span>
                            </li>
                            <li class="list-group-item d-flex flex-row">
                                <span class="material-icons-round me-3">
                                    warning
                                </span>
                                <span class="flex-grow-1">
                                    <button type="button"
                                            class="btn btn-outline-warning"
                                            data-bs-toggle="modal"
                                            data-bs-target="#del_acct_modal">
                                        Delete my account
                                    </button>
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col col-md-6 d-flex flex-column justify-content-center">
                    <img src="{{ url_for('static', filename='img/account_ils.svg') }}"
                         class="img-fluid">
                </div>
            </div>
        </div>
    </div>
</div>


<!--ch_pwd Modal -->
<div class="modal fade"
     id="ch_pwd_modal"
     tabindex="-1"
     aria-labelledby="ch_pwd_modalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"
                    id="ch_pwd_modalLabel">Change Password</h5>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{{url_for('auth.change_password', userid=user.userid)}}"
                      method="POST">
                    <input type="hidden"
                           name="csrf_token"
                           value="{{ csrf_token() }}" />
                    <input type="password"
                           name="current_password"
                           class="form-control mb-3"
                           placeholder="Current Password">
                    <input type="password"
                           name="password1"
                           class="form-control mb-3"
                           placeholder="New Password">
                    <input type="password"
                           name="password2"
                           class="form-control"
                           placeholder="Verify New Password">

                    <div class="d-flex flex-row mt-3 justify-content-between">
                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <button class="btn btn-info"
                                type="submit">
                            Change and Logout
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- del_acct Modal -->
<div class="modal fade"
     id="del_acct_modal"
     tabindex="-1"
     aria-labelledby="del_acct_modalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"
                    id="del_acct_modalLabel">Delete Account</h5>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{{url_for('auth.change_password', userid=user.userid)}}"
                      method="POST">
                    <input type="hidden"
                           name="csrf_token"
                           value="{{ csrf_token() }}" />
                    <h4>Are you sure you want to delete your account?</h4>
                    <p class="p-3 border border-danger rounded text-center"><b>This cannot be reversed</b></p>

                    <p>Deleting your account will permanently delete all your data from our records.
                        You'll lose access to your reservations, messages, etc. If you're experiencing
                        technical problems, please call us before deleting your account, we may be able to
                        resolve your problems without deleting your account.
                    </p>

                    <p><b>To delete you account, please type your username: </b></p>
                    <p>{{g.user.email}}</p>

                    <div class="input-group mb-5">
                        <input type="email"
                               class="form-control"
                               id="del_confirmation">
                        <span class="input-group-text">
                            <span class="material-icons-outlined"
                                  id="delete_indicator">
                                close
                            </span>
                        </span>
                    </div>

                    <div class="d-flex flex-row mt-3 justify-content-between">
                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <button class="btn btn-info disabled"
                                type="submit"
                                id="delete_btn">
                            I'm sure, delete my account.
                        </button>

                        <script>
                            var conf = document.getElementById('del_confirmation');

                            conf.onkeyup = function () {
                                if (conf.value === '{{g.user.email}}') {
                                    document.getElementById('delete_btn').classList.remove('disabled');
                                    document.getElementById('delete_indicator').innerHTML = 'check';
                                } else {
                                    document.getElementById('delete_btn').classList.add('disabled');
                                    document.getElementById('delete_indicator').innerHTML = 'close';
                                }
                            }
                        </script>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}
